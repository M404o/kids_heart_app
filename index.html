<!DOCTYPE html>
<html lang="ja">
  <head>
    <!-- index.htmlå†… -->
    <link rel="stylesheet" href="index.css" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ãã‚‚ã¡ã‚«ãƒ¼ãƒ‰</title>
    <style>
      :root {
        font-size: 20px;
      }
      body {
        margin: 0;
        padding: 1.2rem;
        font-family: "Hiragino Maru Gothic ProN", sans-serif;
        background: #fff7ec;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }
      h1 {
        margin: 0 0 1rem;
        font-size: 1.8rem;
        font-weight: 700;
        color: #333;
      }
      /* å…¥åŠ›æ¬„ */
      textarea {
        width: 100%;
        max-width: 520px;
        height: 110px;
        border: 3px solid #aaa;
        border-radius: 20px;
        font-size: 1.1rem;
        padding: 0.6rem;
        resize: none;
        margin-bottom: 1rem;
        background: #ffffff;
      }
      /* ã‹ãªã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ */
      .kana-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.6rem;
        width: 100%;
        max-width: 520px;
        margin-bottom: 1.4rem;
      }
      .kana-btn {
        font-size: 1.4rem;
        font-weight: 600;
        padding: 0.6rem 0;
        cursor: pointer;
        border: none;
        background: #ffffff;
        border: 2px solid #ccc;
        border-radius: 12px;
        transition: 0.12s;
      }
      .kana-btn:active {
        background: #eee;
      }

      /* æ„Ÿæƒ…ãƒœã‚¿ãƒ³ */

      .emoji-btn {
        font-size: 1.6rem;
        padding: 0.8rem;
        border: 2px solid #ccc;
        border-radius: 0.5rem;
        background-color: #fff;
        cursor: pointer;
        text-align: center;
        line-height: 1;
      }

      .emoji-btn.selected {
        border-color: #5bbe7d;
        box-shadow: 0 0 8px #5bbe7d80;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒœã‚¿ãƒ³ */
      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: center;
        gap: 2rem;
        padding: 0.8rem 0;
        background: #fff;
        box-shadow: 0 -3px 6px #0002;
      }
      .footer button {
        font-size: 1.1rem;
        font-weight: 700;
        border: none;
        color: #fff;
        background: #5bbe7d;
        padding: 0.8rem 2.4rem;
        border-radius: 14px;
        cursor: pointer;
      }
      .footer button:active {
        filter: brightness(0.85);
      }
      /* ãƒ­ã‚°è¡¨ç¤º */
      #logBox {
        width: 100%;
        max-width: 520px;
        margin-bottom: 120px;
        display: none;
      }
      #logBox h2 {
        font-size: 1.2rem;
        margin: 0.6rem 0 0.3rem;
        font-weight: 700;
      }
      #logList {
        padding-left: 1rem;
        margin: 0;
        font-size: 1rem;
        line-height: 1.4;
      }
      /* 15æ–‡å­—ã‚’ 5Ã—3 ã§å‡ç­‰é…ç½® */
      .kana-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
        font-size: 2rem;
        text-align: center;
      }
      .kana-grid > * {
        padding: 12px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        cursor: pointer;
      }
      .output-box {
        padding: 4px;
        min-height: 1em;
      }
    </style>
  </head>
  <body>
    <h1>ãã‚‚ã¡ã‚¢ãƒ—ãƒª</h1>
    <!-- ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ï¼ˆä»»æ„ï¼‰ -->
    <textarea id="txt" placeholder="ã‚ã„ã†ãˆãŠã‚¿ãƒƒãƒ—ã§ ã“ã¨ã° ãŒ ã¤ãã‚Œã‚‹ã‚ˆ">
    </textarea>
    <!-- ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼šã“ã“ã«å…¥ã‚Œã‚‹ -->
    <div id="output" class="output-box"></div>
    <!-- æ„Ÿæƒ…ãƒœã‚¿ãƒ³ -->
    <section class="emoji-grid" id="grid">
<div>
<button  class="emoji-btn" onclick="handleEmojiClick('ğŸ™‚')">ğŸ™‚</button>
<button  class="emoji-btn" onclick="handleEmojiClick('ğŸ˜¢')">ğŸ˜¢</button>
<button  class="emoji-btn" onclick="handleEmojiClick('ğŸ˜¡')">ğŸ˜¡</button>
<button  class="emoji-btn" onclick="handleEmojiClick('âŒ')">âŒ</button>

</div>

    </section>
    <script>
      document.getElementById("sendBtn").addEventListener("click", () => {
        const userInput = document.getElementById("txt").value;
        console.log("é€ä¿¡ã•ã‚ŒãŸå†…å®¹:", userInput);
      });
    </script>
    <!-- â–¼å·¦å³ãƒ»é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <div class="kana-nav">
      <button id="prevPage">â—€ï¸</button>
      <button id="sendBtn">ãŠãã‚‹</button>
      <button id="nextPage">â–¶ï¸</button>
    </div>

    <!-- â–¼ã‹ãª5æ–‡å­—Ã—3è¡Œã‚’å…¥ã‚Œã‚‹å™¨ -->
    <section id="kana-grid" class="kana-grid"></section>
    <script>
      const kanaPages = [
        [
          "ã‚",
          "ã„",
          "ã†",
          "ãˆ",
          "ãŠ",
          "ã‹",
          "ã",
          "ã",
          "ã‘",
          "ã“",
          "ã•",
          "ã—",
          "ã™",
          "ã›",
          "ã",
        ],
        [
          "ãŸ",
          "ã¡",
          "ã¤",
          "ã¦",
          "ã¨",
          "ãª",
          "ã«",
          "ã¬",
          "ã­",
          "ã®",
          "ã¯",
          "ã²",
          "ãµ",
          "ã¸",
          "ã»",
        ],
        [
          "ã¾",
          "ã¿",
          "ã‚€",
          "ã‚",
          "ã‚‚",
          "ã‚„",
          "ã‚†",
          "ã‚ˆ",
          "ã‚‰",
          "ã‚Š",
          "ã‚‹",
          "ã‚Œ",
          "ã‚",
          "ã‚",
          "ã‚“",
        ],
      ];

      let current = 0;

      // ãƒœã‚¿ãƒ³ç”Ÿæˆã¨åæ˜ 
      function renderKana() {
        const grid = document.getElementById("kana-grid");
        grid.innerHTML = "";

        kanaPages[current].forEach((k) => {
          const btn = document.createElement("button");
          btn.textContent = k;
          btn.className = "kana-btn";
          btn.addEventListener("click", () => {
            const txtArea = document.getElementById("txt");
            txtArea.value += k;
          });
          grid.appendChild(btn);
        });
      }

      /* ---------------- ãƒŠãƒ“ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ ---------------- */
      // â–¶ï¸ ãƒœã‚¿ãƒ³
      document.getElementById("nextPage").onclick = () => {
        if (current < kanaPages.length - 1) current++;
        renderKana();
      };

      // â—€ï¸ ãƒœã‚¿ãƒ³
      document.getElementById("prevPage").onclick = () => {
        if (current > 0) current--;
        renderKana();
      };
sendBtn.addEventListener("click", async () => {
  const inputText = txt.value.trim();
  if (!inputText) return;

  try {
    const res = await fetch("/api/chat", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ message: inputText }),
    });
function handleEmojiClick(emoji) {
  const txt = document.getElementById("inputText");
  txt.value += emoji;
}
    const data = await res.json();
    console.log("è¿”ã£ã¦ããŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š", data);

    // ğŸ§© å­ã©ã‚‚å‘ã‘ã«å¤‰æ›ã—ã¦è¡¨ç¤º
    const shortReply = shortenForKids(data.reply);
    document.getElementById("output").innerHTML = shortReply;

  } catch (err) {
    console.error("GPTã¨ã®é€šä¿¡ã‚¨ãƒ©ãƒ¼", err);
    document.getElementById("output").textContent = "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ";
  }
});

// âœ… ã“ã“ã§å®šç¾©ï¼ˆé–¢æ•°ã®å¤–ã«ç½®ã„ã¦OKï¼‰
function shortenForKids(text) {
  const lines = text.split("\n").filter(l => l.trim() !== "");
  const firstTwo = lines.slice(0, 2).join(" ");

  return firstTwo
    .replace("ãƒªãƒ©ãƒƒã‚¯ã‚¹", "ã‚„ã™ã‚“ã§")
    .replace("ä¼‘æ†©", "ã¡ã‚‡ã£ã¨ã‚„ã™ã‚“ã§")
    .replace("ãŠæ‰‹ä¼ã„", "ã§ãã‚‹ã“ã¨ãŒã‚ã‚Œã°è¨€ã£ã¦ã­")
    .replace("ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“", "ã‹ã‚‚ã­")
    .replace("æ•™ãˆã¦ãã ã•ã„", "ãŠã—ãˆã¦ã­ğŸ™‚");
}

      /* åˆæœŸåŒ–ï¼šæœ€åˆã®ãƒšãƒ¼ã‚¸ã‚’æç”» */
      renderKana();
    </script>

    <!-- ãƒ­ã‚°è¡¨ç¤º -->
    <section id="logBox">
      <h2>ğŸ“‹ ãã‚‡ã†ã®ã‚ã—ã‚ã¨</h2>
      <ul id="logList"></ul>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ãƒœã‚¿ãƒ³ -->
    <div class="footer">
      <button id="parentBtn">è¦ªãŒã¿ã‚‹</button>
      <button id="endBtn">ãŠã‚ã‚‹</button>
    </div>

    <script>
      const counts = {};
      const logList = document.getElementById("logList");
      const logBox = document.getElementById("logBox");
      const txtArea = document.getElementById("txt");

      // é¡”ãƒœã‚¿ãƒ³æŠ¼ä¸‹ â†’ é¸æŠçŠ¶æ…‹&ã‚«ã‚¦ãƒ³ãƒˆ
      document.querySelectorAll(".emoji-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          btn.classList.toggle("selected");
          const emo = btn.textContent;
          counts[emo] = (counts[emo] || 0) + 1;
        });
      });

      // è¦ªãŒã¿ã‚‹
      document.getElementById("parentBtn").addEventListener("click", () => {
        logList.innerHTML = "";
        Object.entries(counts).forEach(([emo, c]) => {
          const li = document.createElement("li");
          li.textContent = `${emo} Ã— ${c}`;
          logList.appendChild(li);
        });
        const txt = txtArea.value.trim();
        if (txt) {
          const li = document.createElement("li");
          li.textContent = `ã“ã¨ã°: ${txt}`;
          logList.appendChild(li);
        }
        logBox.style.display = "block";
      });
      // ãŠã‚ã‚‹ï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰

      document.getElementById("sendBtn").addEventListener("click", () => {
        const userInput = document.getElementById("txt").value;
        console.log("é€ä¿¡ã•ã‚ŒãŸå†…å®¹:", userInput);
      });
    </script>
  </body>
</html>

